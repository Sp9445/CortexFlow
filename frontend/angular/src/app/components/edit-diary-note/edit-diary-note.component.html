<div class="editor-shell">
  <div class="editor-wrapper">
    <header class="editor-header">
      <button type="button" class="ghost-button back-button" (click)="onBack()" aria-label="Back to notes">
        <span aria-hidden="true">‚Üê</span>
        <span>Back to notes</span>
      </button>
      <div class="title-block">
        <p class="eyebrow">Diary Companion</p>
        <h1>{{ entryId === '0' ? 'New Note' : 'Edit Note' }}</h1>
      </div>
    </header>

    <section class="editor-panel" #editorPanel>
      <div *ngIf="isLoading" class="status-card">
        <p>Loading entry...</p>
      </div>

      <div *ngIf="errorMessage && !isLoading" class="status-card error-card">
        <p>{{ errorMessage }}</p>
      </div>

      <div *ngIf="successMessage" class="status-card success-card">
        <p>{{ successMessage }}</p>
      </div>

      <div *ngIf="!isLoading" class="editor-card">
        <div class="field-block">
          <label class="field-label">Note</label>
          <textarea
            [(ngModel)]="rawText"
            name="rawText"
            placeholder="Write your diary entry here..."
            rows="10"
            class="note-editor"
          ></textarea>
          <div class="helper-row">
            <span>{{ getTextLength() }} characters</span>
            <span *ngIf="!canShowActions" class="text-warning">(Minimum 25 characters required)</span>
          </div>
        </div>

        <div *ngIf="canShowActions" class="action-row">
          <button
            (click)="onImprove()"
            [disabled]="isImproving || isSaving"
            class="secondary-button"
          >
            {{ isImproving ? 'Improving...' : '‚ú® Improve' }}
          </button>
          <button
            (click)="onSave()"
            [disabled]="isSaving || isImproving"
            class="primary-button"
          >
            {{ isSaving ? 'Saving...' : 'üíæ Save' }}
          </button>
        </div>
      </div>

      <div *ngIf="showImprovedView && improvedText" class="editor-card highlight-card">
        <div class="field-label">
          <span>Improved Text</span>
          <span class="tag">AI Improved</span>
        </div>
        <div class="improved-text">
          {{ improvedText }}
        </div>
        <div class="action-row">
          <button (click)="onEditImproved()" [disabled]="isSaving" class="secondary-button">
            ‚úèÔ∏è Edit This Version
          </button>
          <button (click)="onSave()" [disabled]="isSaving || isImproving" class="primary-button">
            {{ isSaving ? 'Saving...' : 'üíæ Save' }}
          </button>
        </div>
      </div>
    </section>
  </div>
</div>
