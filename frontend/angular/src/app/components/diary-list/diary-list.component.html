<div class="notes-shell">
  <div class="notes-wrapper">
    <header class="notes-header">
      <div class="title-block">
        <p class="eyebrow">Diary Companion</p>
        <h1>My Notes</h1>
      </div>
      <div class="notes-actions">
        <button type="button" class="ghost-button" (click)="onNewChat()">AI Chat</button>
        <button type="button" class="primary-button" (click)="onNewNote()">+ New Note</button>
        <button type="button" class="ghost-button" (click)="onLogout()">Logout</button>
      </div>
    </header>

    <section class="notes-panel">
      <div class="panel-card" [class.is-collapsed]="!showFilters">
        <div class="panel-card__header">
          <h2>Filter Entries</h2>
          <button type="button" class="ghost-button mini-toggle" (click)="toggleFilters()">
            {{ showFilters ? 'Collapse filters' : 'Show filters' }}
          </button>
        </div>
        <div *ngIf="showFilters" class="filter-body">
          <div class="filter-grid">
            <label class="field-group">
              <span class="field-label">From Date</span>
              <input
                type="date"
                [(ngModel)]="fromDate"
                name="fromDate"
                class="input-field"
              />
            </label>
            <label class="field-group">
              <span class="field-label">To Date</span>
              <input
                type="date"
                [(ngModel)]="toDate"
                name="toDate"
                class="input-field"
              />
            </label>
            <label class="field-group">
              <span class="field-label">Search</span>
              <input
                type="text"
                [(ngModel)]="searchText"
                name="search"
                placeholder="Search text..."
                class="input-field"
              />
            </label>
          </div>
          <div class="filter-actions">
            <button type="button" class="primary-button" (click)="onSearch()">Search</button>
            <button type="button" class="ghost-button" (click)="resetFilters()">Reset</button>
          </div>
        </div>
        <div *ngIf="!showFilters" class="collapsed-note">
          Filters hidden — click
          <button class="ghost-button mini-toggle inline-reset" type="button" (click)="toggleFilters()">Edit filters</button>
          to refine results.
        </div>
      </div>
      <div *ngIf="errorMessage" class="alert error-alert">
        <p>{{ errorMessage }}</p>
      </div>

      <div *ngIf="isLoading" class="loading-state">
        <p class="loading-message">{{ loadingMessage }}</p>
      </div>

      <div *ngIf="!isLoading && diaryEntries.length === 0" class="empty-state">
        <p>No diary entries found.</p>
        <p class="empty-subtext">Start by creating your first note!</p>
      </div>

      <div *ngIf="!isLoading && diaryEntries.length > 0" class="notes-grid">
        <article
          *ngFor="let entry of diaryEntries"
          (click)="onNoteClick(entry)"
          class="note-card"
        >
          <div class="note-card__header">
            <p>{{ formatDate(entry.created_at) }}</p>
            <button
              type="button"
              class="icon-button"
              (click)="onDeleteEntry(entry, $event)"
              title="Delete note"
              aria-label="Delete note"
            >
              <svg viewBox="0 0 20 20" focusable="false">
                <path
                  d="M6 6h8l-1 12H7L6 6zm2-3h4l1 1h3v2H2V4h3l1-1z"
                  fill="currentColor"
                ></path>
              </svg>
            </button>
          </div>
          <div class="note-card__body">
            <div *ngIf="entry.is_improved && entry.improved_text" class="improved-badge">
              Improved
            </div>
            <p class="note-card__text">
              {{ truncateText(entry.improved_text || entry.raw_text) }}
            </p>
            <div class="note-card__footer">
              <p class="note-card__meta">Last updated: {{ formatDate(entry.updated_at) }}</p>
              <span class="note-card__action">View →</span>
            </div>
          </div>
        </article>
      </div>
    </section>
  </div>
</div>
